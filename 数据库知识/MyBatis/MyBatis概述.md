# Mybatis简介

本文介绍了ORM以及MyBatis

# 对象/关系型数据库映射（ORM）

ORM全称是Object/Relation Mapping，即对象/关系型数据库映射。可以将ORM理解为一种规范，它概述了这类框架的基本特征，完成面向对象的编程语言到关系型数据库的映射。当ORM完成映射后，程序员既可以利用面向对象程序设计的简易性，又可以利用关系型数据库的优势。ORM工具唯一的作用就是： **把持久化对象的保存、修改、删除等操作，转换成对数据库的操作。** 因此，程序猿可以以面向对象的方式操作持久化对象，而ORM框架则负责将相关操作转换成对应的SQL（结构化查询语言）操作。


## ORM的基本映射方式

ORM工具提供了持久化类和数据库表之间的映射关系。

1. 数据表映射类 持久化类被映射到一个数据表。程序使用这个持久化类来创建实例，修改属性，删除实例时，系统会自动转换为对这个表进行CRUD操作。
2. 数据表列（字段）映射对象的属性 当程序修改某个持久化对象的属性指定属性时（持久化实例映射到数据行），ORM将会将其转换成对对应数据表中指定的数据行、指定列的操作。


## 流行的ORM框架简介

目前流行的ORM框架：

> - JPA JPA本身只是一种ORM规范，并不是ORM产品。它是JAVAEE规范制定者向开源社区学习的结果。相对于其他开源ORM框架，JPA最大的优势在于它是官方标准。
> - Hibernate 目前流行的开源ORM框架，被选为JB偶是是的持久层解决方案。
> - MyBatis(早期名为iBatis). 更应该称为"SQL Mapper"框架，它是一种“半自动化”的ORM实现，并不支持纯粹的面向对象操作，允许开发人员直接编写SQL语句。


# MyBatis概述

MyBatis是一个支持普通SQL查询、存储过程和高级映射的优秀持久层框架。MyBatis去掉了所有的JDBC代码和参数的手工设置以及对应结果集的检索封装。MyBatis可以使用简单的XML或注解进行配置和原始映射，以将接口和Java的POJO（Plain Old Java Object，普通的Java对象）映射成数据库中的纪录。

MyBatis作为一种持久层框架，它的主要思想就是将程序中的大量SQL语句剥离出来，配置在配置文件中，以实现SQL的灵活配置。这样做的好处是将SQL与程序代码分离，做到不修改代码的情况下，直接在配置文件中修改SQL。 当前主流的ORM, Hibernate和JPA，对数据库结构提供了较为完整的封装，提供了从POJO到数据库的全套映射机制。程序员往往只需要定义好POJO到数据库表的映射关系，即可通过Hibernate或者JPA提供的方法完成持久层操作。Hibernate/JPA会根据制定的存储逻辑自动生成对应的SQL并调用JDBC接口加以执行。 MyBatis则是提供了半自动化的操作，这是牺牲了移植性和工作量为代价而换取更多的灵活性。

ORM框架中都有一个非常重要的媒介：PO（持久化对象）。持久化对象的作用就是完成持久化操作，简单说，就是通过该对象对数据库执行增、删和改的操作，以面向对象的方式操作数据库。 应用程序无须直接访问数据库，甚至无须理会底层数据库采用何种数据库，这一切对应用程序透明，应用程序只需创建、修改、删除持久化对象即可；与此同时。MyBatis负责八这种操作转换为指定数据库表的操作。 MyBatis的PO对象采用低侵入式的设计，完全采用普通的Java对象作为持久化对象使用。 MyBatis直接采用了POJO作为持久化类，这就是MyBatis被称为低侵入式设计的原因。MyBatis不需要持久化类继承任何父类，或者实现任何接口，这样可以保证代码不被污染。

 使用MyBatis进行持久化操作，通常有下面的操作：

 1. 开发持久化类PO和编写持久化操作的Mapper.xml，在其中定义要执行的SQL语句。
 2. 获取SqlSessionFactory
 3. 获取SqlSession
 4. 用面向对象的方式操作数据库
 5. 关闭事务，关闭SqlSession

 对PO的操作必须在SqlSession的管理下才能同步到数据库。SqlSession由SqlSessionFactory工厂产生，SqlSessionFactory是数据库编译后的内存镜像，通常一个应用对应一个SqlSessionFactory对象。SqlSessionFactory对象通过加载mybatis-config.xml配置文件生成。

 对比MyBatis和JDBC两种操作方式，可以发现MyBatis的两个显著优点：

 1. 只需要在Mapper.xml配置文件中编写SQL语句，在应用程序中就可以采用OO方式来访问数据库。
 2. 在JDBC访问过程中大量的checked异常被包装成MyBatis的Runtime异常，从而不再要求程序必须处理所有异常。