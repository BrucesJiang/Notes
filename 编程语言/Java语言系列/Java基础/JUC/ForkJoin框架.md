# Fork/Join框架
本文将会介绍Fork/Join框架的基本原理，算法，设计方式，实现和应用。

## 基本原理
Fork/Join框架是Java 7提供的一个用于并行执行任务的框架，是一个把较大任务分割成若干个小任务，最终汇总每个小任务结果后得到大任务结果的框架。

其原理如下图所示：

![ForkJoin](./images/ForkJoin.png)

## 工作窃取算法
工作窃取算法(work-stealing)指的是某个线程从其他线程任务列表中窃取任务来执行。为什么要使用工作窃取算法？假如我们有一个比较大的任务，可以把这个任务分解为若干个互不依赖的子任务，为了减少线程之间的竞争，把这些子任务分别放在不同的队列里，并为每个队列创建一个单独的线程来执行队列中的任务，线程和队列一一对应。例如A线程负责处理队列QA中的任务。但是有些线程会将自己队列中的任务先做完，而其他线程对应队列中还有任务等待处理。那么处理完任务的线程就会从其他任务队列中窃取一个任务来处理。而在这时它们会访问同一个队列，所以为了减少窃取任务线程和被窃取任务线程之间的竞争，通常会使用双端队列，被窃取任务线程永远从双端队列的头部拿任务执行，而窃取任务的线程永远从双端队列的尾部拿任务执行。

工作窃取算法的优点是充分利用线程进行并行计算，并减少了线程间的竞争，其缺点是在某些情况下还是存在竞争，比如双端队列里只有一个任务时。并且消耗了更多的系统资源，比如创建多个线程和多个双端队列。


## Fork/Join框架设计
我们叙述Fork/Join框架原理时将其分为两个部分：分割和结果合并。

 
